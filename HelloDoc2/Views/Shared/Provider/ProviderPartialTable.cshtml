@model DAL.ViewModelProvider.ProviderDashboardVm;


<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
</head>


<div class="mt-2 mb-2 container-fluid ">

    <div class="table-responsive d-none d-md-block">
            <table class="table overflow-visible" id="New">
                <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Phone</th>
                        <th scope="col">Address</th>
                        @if(Model.requestDataProvider.Any(x => x.StatusForDash == 4 || x.StatusForDash == 5))
                        {
                            <th scope="col">Status</th>
                        }
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                @foreach(var obj in Model.requestDataProvider)
                {
                    <tr class="align-middle color_@obj.RequestTypeId" id="SearchData">
                        <td><div>@obj.Name</div></td>
                        <td><div>@obj.Phone</div></td>
                        <td><div>@obj.Address</div></td>
                        @if(obj.StatusForDash == 5 || obj.StatusForDash == 4)
                        {
                            if (obj.StatusForDash == 5)
                            {
                                <td><button class="btn btn-info text-white" onclick="window.location.href='@Url.Action("HouseCall","Provider",new{requestId = obj.RequestId})'">House Call</button></td>
                            }
                            else
                            {
                                <td><div></div></td>
                            }
                        }
                        <td class="dropdown">
                            <button class="btn btn-outline-primary text-white border-white d-none d-md-block" data-bs-toggle="dropdown">Actions</button>
                            <ul class="dropdown-menu overflow-visible">
                                @if(Model.requestDataProvider.Any(x => x.StatusForDash == 1))
                                {
                                    <li class="d-flex align-items-center ps-1"><a data-requestId=" @obj.RequestId" id="accept">Accept</a></li>
                                }
                                @if(Model.requestDataProvider.Any(x => x.StatusForDash == 6))
                                {
                                    <li class="d-flex align-items-center ps-1"><i class="bi bi-card-checklist me-1"></i><a class="dropdown-item p-1">Conclude Care</a></li>
                                }
                                @if(Model.requestDataProvider.Any(x => x.StatusForDash == 2))
                                {
                                    <li class="d-flex align-items-center ps-1"><i class="bi bi-card-checklist me-1"></i><a class="dropdown-item p-1" onclick="sendagreementprovider(@obj.RequestId,@obj.RequestTypeId)">Send Agreement</a></li>
                                }

                                <li class="d-flex align-items-center ps-1"><i class="bi bi-search me-1"></i><button class="dropdown-item p-1 @(ViewBag.ActiveDashboardNav == "ProviderDashboard" ? "active" : "")" onclick="location.href='@Url.Action("ViewCase","Provider", new {requestId = obj.RequestId})'">View Case</button></li>

                                <li class="d-flex align-items-center ps-1"><i class="bi bi-card-checklist me-1"></i><button class="dropdown-item p-1" onclick="location.href='@Url.Action("ViewNotes","Provider", new {requestId = obj.RequestId})'">View Notes</button></li>


                                @if(Model.requestDataProvider.Any(x => x.StatusForDash == 2 || x.StatusForDash == 4 || x.StatusForDash == 5 || x.StatusForDash == 6))
                                {
                                    <li class="d-flex align-items-center ps-1"><i class="bi bi-card-checklist me-1"></i><button class="dropdown-item p-0" onclick="location.href='@Url.Action("ViewUploadsProvider","Provider", new {requestId = @obj.RequestId})'">View Uploads</button></li>
                                }
                                @if(Model.requestDataProvider.Any(x => x.StatusForDash == 2))
                                {
                                    <li class="d-flex align-items-center ps-1"><i class="bi bi-card-checklist me-1"></i><button class="dropdown-item p-1" onclick="transfercase(@obj.RequestId)">Transfer</button></li>
                                }
                                @if(Model.requestDataProvider.Any(x => x.StatusForDash == 4 || x.StatusForDash == 5))
                                {
                                    <li class="d-flex align-items-center ps-1"><i class="bi bi-card-checklist me-1"></i><button class="dropdown-item p-1" onclick="location.href='@Url.Action("Orders","Provider", new {requestId = @obj.RequestId})'">Orders</button></li>
                                }
                                @if(obj.StatusForDash == 4 || obj.StatusForDash == 5 || obj.StatusForDash == 6)
                                {
                                    if(obj.StatusForDash == 5 || obj.StatusForDash == 6)
                                    {
                                        if(obj.IsFinalize == false)
                                        {
                                        <li class="d-flex align-items-center"><i class="bi bi-card-checklist me-1"></i><button class="dropdown-item p-1" onclick="window.location.href='@Url.Action("EncounterForm","Provider", new {requestId = obj.RequestId})'">Encounter</button></li>
                                        }
                                        <li class="d-flex align-items-center"><i class="bi bi-card-checklist me-1"></i><button class="dropdown-item p-1" onclick="encounterfinalize(@obj.RequestId)"></button></li>
                                    }
                                    else
                                    {
                                        <li class="d-flex align-items-center ps-1"><i class="bi bi-card-checklist me-1"></i><button class="dropdown-item p-1" onclick="encounterpopup(@obj.RequestId)">Encounter</button></li>
                                    }
                                }
                            </ul>
                        </td>
                    </tr>
                }                    
                </tbody>
            </table>
        </div>

</div>

<div id="contentSendAgreement"></div>
<div id="contentTransferNote"></div>
<div id="encounterpopup"></div>

<nav aria-label="Page navigation example " class="pb-1 mx-4">
    <div class="justify-content-between d-flex">
        @if ((Model.skipCount + Model.Page.itemperpage) >= Model.Page.totalitem)
        {
            <p style="margin:0px; color:gray;">@(Model.skipCount + 1) to @Model.Page.totalitem records out of @Model.Page.totalitem</p>
        }
        else
        {
            <p style="margin:0px; color:gray;">@(Model.skipCount + 1) to @(Model.skipCount + Model.Page.itemperpage) records out of @Model.Page.totalitem</p>
        }
        <ul class="pagination">
            <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                <button class="page-link" id="prevPageLink">Previous</button>
            </li>

            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(Model.CurrentPage == i ? "active" : "")">
                    <button class="page-link" id="pageLink">@i</button>
                </li>
            }

            <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                <button class="page-link" id="nextPageLink">Next</button>
            </li>
        </ul>
    </div>
</nav>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
@section Scripts {
    @{
                <partial name="_ValidationScriptsPartial" />
    }
}


<script>
    var acceptbtn = document.getElementById('accept');
        acceptbtn.addEventListener('click', function (event) {

        event.preventDefault();
        console.log('Accept button clicked');

        var requestId = event.target.getAttribute('data-requestId');
        console.log(requestId);
        Swal.fire({
            title: 'Are you sure?',
            text: "Are you Sure You Want to accept this request!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#198754',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, Accept it!'
        }).then((result) => {

            if (result.isConfirmed) {
                window.location.href = '/Provider/Accept?requestId=' + requestId;
            }
        });
    });


    //ajax for Send agreement model
    function sendagreementprovider(reqid, reqtypeid) {
        console.log("CLicked send agreement")
        console.log(reqtypeid)
        $.ajax({
            url: "/Provider/SendAgreementProvider",
            type: 'GET',
            data: {
                req: reqid,
                reqTypeId: reqtypeid
            },
            success: function (result) {
                console.log(result);
                $('#contentSendAgreement').html(result);
                $('#mySendAgreement').modal("show");

            },
            error: function () {
                alert('Something went wrong');
            },
        });
    };


    //ajax for transfer case model
    function transfercase(reqid) {

        console.log("CLicked")

        let action = "/Provider/TransferCaseProvider"
        $.ajax({
            url: action,
            type: 'GET',
            data: { reqId: reqid },
            success: function (result) {
                console.log(result)
                $('#contentTransferNote').html(result);
                $('#myModalTransfer').modal('show');

            },
            error: function () {
                alert('Error loading partial view');
            }
        });
    };


    //ajax for encounter popup model
    function encounterpopup(requestId) {

        console.log("CLicked")
        $.ajax({
            url: '@Url.Action("EncounterPopUp", "Provider")',
            type: 'GET',
            data: {requestId : requestId},
            success: function (result) {
                console.log(result)
                $('#encounterpopup').html(result);
                $('#TypeOfCare').modal('show');

            },
            error: function () {
                alert('Error loading partial view');
            }
        });
    };
    
    
    
    //ajax for encounter finalize popup model
    function encounterfinalize(requestId) {

        console.log("CLicked")
        $.ajax({
            url: '@Url.Action("EncounterFinalize", "Provider")',
            type: 'GET',
            data: {requestId : requestId},
            success: function (result) {
                console.log(result)
                $('#encounterfinalize').html(result);
                $('#encounterFinalize').modal('show');

            },
            error: function () {
                alert('Error loading partial view');
            }
        });
    }


</script>